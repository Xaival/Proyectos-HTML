<!DOCTYPE html>
<html lang="es" >
<head>
<meta charset="UTF-8">
<title>Temporizador</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Teko:wght@300&display=swap" rel="stylesheet">
<style>
	* {margin:0; padding:0; box-sizing:border-box;}
	body{
		background-color: #101010;
		color: white;
		font-weight: bold;
		font-family: Roboto;
		font-size: min(25px, max(4.16vw, 13px));

		text-align:center;
		margin-top: min(25px, 4.16vw);
	}

	div{
		max-width: min(330px, 55vw);
		max-height: min(330px, 55vw);

		position:relative;
		left: 50%;
		cursor:pointer;
		border-radius: 50%;
		margin-left: max(-165px, -27.5vw);
		margin-bottom: 30px;
	}
	div:hover{
		background-color: #1e1e1e;
		color: #afafaf;
	}

	#Circle {max-height: 500%;}

	/* stroke-width Ancho*/
	#Circle path {fill: none; stroke-width: 0.5;}
	#Circle #Circulo-bg {stroke: #1f1f1f;}
	#Circle #Circulo {
		stroke: #00FFFF;
		stroke-dasharray: 100, 100;
		stroke-linecap: round;
		transition-delay: 3s;
	}


	#CuentaRegresiva {
		position: absolute;
		top: calc(50% - 0.65em);
		width: 100%;
		font-size: 3em;
		text-align: center;
		font-family: 'Teko', sans-serif;
	}

	/* Pausa */
	#PausaReplay{
		width:60%;
		height:60%;
		position: absolute;
		top: 20%;
		left: 20%;
		display: none;
	}
	div:hover #PausaReplay{display: block;}

	input, button{
		font-size: min(30px, max(5vw, 13px));
		text-align:center;
	}

	button{
		background-color: #101010;
		box-shadow: 0 -1px 0 black, 0 0px 10px cyan, 0 0px 5px cyan;
		margin-top: 50px;

		cursor:pointer;
		color: white;
		border-radius: 20px;
		padding: min(15px, 2.5vw) min(30px, 5vw);
	}
</style>
</head>
<body>
	<div>
		<svg id="Circle" viewBox="1.75 1.75 32.5 32.5"><path id="Circulo-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/><path id="Circulo" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/></svg>
		<p id="CuentaRegresiva">00 : 00 : 00</p>
		<svg id="PausaReplay" viewBox="-7 -7 83 83" fill="#FFF" onclick="PauseReplay()"><path d="M33.511,71.013c15.487,0,28.551-10.563,32.375-24.859h9.113L61.055,22L47.111,46.151h8.006   c-3.44,8.563-11.826,14.628-21.605,14.628c-12.837,0-23.28-10.443-23.28-23.28c0-12.836,10.443-23.28,23.28-23.28   c6.604,0,12.566,2.768,16.809,7.196l5.258-9.108c-5.898-5.176-13.619-8.32-22.065-8.32C15.034,3.987,0,19.019,0,37.5   C-0.002,55.981,15.03,71.013,33.511,71.013z"/></svg>
	</div>

	<input type="number" id="PlusHoras" value="0" min="0" max="99"> :
	<input type="number" id="PlusMinutos" value="0" min="0" max="60" onchange="CambiosM()"> :
	<input type="number" id="PlusSegundos" value="0" min="0" max="60" onchange="CambiosS()">
	<br>
	<button onclick="Comenzar()">Comenzar</button>
<script>
	var timerA, timerB, PauseReplayBool=true,
	PlusHoras = document.getElementById("PlusHoras"),
	PlusMinutos = document.getElementById("PlusMinutos"),
	PlusSegundos = document.getElementById("PlusSegundos"),
	Circulo = document.getElementById("Circulo"),
	CuentaRegresiva = document.getElementById("CuentaRegresiva"),
	PausaReplay = document.getElementById("PausaReplay");


	function CambiosS() {
		if(PlusSegundos.value >= 60){
			PlusMinutos.value = parseInt(PlusMinutos.value, 10) + 1;
			PlusSegundos.value = parseInt(PlusSegundos.value, 10) - 60;
		}
		if(PlusSegundos.value >= 60){CambiosS();}
	}
	function CambiosM() {
		if(PlusMinutos.value >= 60){
			PlusHoras.value = parseInt(PlusHoras.value, 10) + 1;
			PlusMinutos.value = parseInt(PlusMinutos.value, 10) - 60;
		}
		if(PlusMinutos.value >= 60){CambiosM();}
	}

	function PauseReplay() {
		/* Si se esta parado */
		if(PauseReplayBool){Comenzar();}
		else{
			timerA.finish();
			clearTimeout(timerB);
			PlusHoras.value = Horas;
			PlusMinutos.value = Minutos;
			PlusSegundos.value = Segundos;
			PausaReplay.innerHTML = `<path d="M33.511,71.013c15.487,0,28.551-10.563,32.375-24.859h9.113L61.055,22L47.111,46.151h8.006   c-3.44,8.563-11.826,14.628-21.605,14.628c-12.837,0-23.28-10.443-23.28-23.28c0-12.836,10.443-23.28,23.28-23.28   c6.604,0,12.566,2.768,16.809,7.196l5.258-9.108c-5.898-5.176-13.619-8.32-22.065-8.32C15.034,3.987,0,19.019,0,37.5   C-0.002,55.981,15.03,71.013,33.511,71.013z"/>`;
			PauseReplayBool=true;
		}
	}

	function Comenzar() {
		// Cambios de boton
		PauseReplayBool=false;
		PausaReplay.innerHTML = `
			<rect x="43" y="2" width="20" height="70"/>
			<rect x="7" y="2" width="20" height="70"/>`;

		// Importar valores
		Segundos = parseInt(PlusSegundos.value, 10);
		Minutos = parseInt(PlusMinutos.value, 10);
		Horas = parseInt(PlusHoras.value, 10);

		// Evitar que se duplique las funciones
		if(timerA!==null){clearTimeout(timerA);}
		if(timerB!==null){clearTimeout(timerB);}

		// Circulo
		Duracion = parseInt(PlusSegundos.value, 10)+parseInt(PlusMinutos.value, 10)*60+parseInt(PlusHoras.value, 10) * 3600;

		timerA=Circulo.animate([
			{strokeDasharray: "100, 100"},
			{strokeDasharray: "0, 100"}],
			{duration: Duracion*1000});

		// Previo al bucle para evitar delay
		// Añadir 0 delante si es menor que 10
		if(Segundos < 10){PrindSegundos = "0"+Segundos;} else {PrindSegundos = Segundos;}
		if(Minutos < 10){PrindMinutos = "0"+Minutos;} else {PrindMinutos = Minutos;}
		if(Horas < 10){PrindHoras = "0"+Horas;} else {PrindHoras = Horas;}

		// Imprimir
		CuentaRegresiva.innerHTML = PrindHoras+" : "+PrindMinutos+" : "+PrindSegundos;

		// Bucle que va restando
		timerB=setInterval(function(){
			// Restar
			Segundos--;
			if(Segundos <= 0 && Minutos >= 1){
				Segundos = Segundos + 60;
				Minutos = Minutos - 1;
			} else if(Segundos <= 0 && Minutos <= 0 && Horas >= 1){
				Horas = Horas - 1;
				Minutos = Minutos + 59;
				Segundos = Segundos + 60;
			}

			//Terminar bucle
			if(Horas<=0 && Minutos<=0 && Segundos<=0){
				finish.playclip();
				clearTimeout(timerB);
				PausaReplay.innerHTML = `<path d="M33.511,71.013c15.487,0,28.551-10.563,32.375-24.859h9.113L61.055,22L47.111,46.151h8.006   c-3.44,8.563-11.826,14.628-21.605,14.628c-12.837,0-23.28-10.443-23.28-23.28c0-12.836,10.443-23.28,23.28-23.28   c6.604,0,12.566,2.768,16.809,7.196l5.258-9.108c-5.898-5.176-13.619-8.32-22.065-8.32C15.034,3.987,0,19.019,0,37.5   C-0.002,55.981,15.03,71.013,33.511,71.013z"/>`;
				PauseReplayBool=true;
			}

			// Añadir 0 delante si es menor que 10
			if(Segundos < 10){PrindSegundos = "0"+Segundos;} else {PrindSegundos = Segundos;}
			if(Minutos < 10){PrindMinutos = "0"+Minutos;} else {PrindMinutos = Minutos;}
			if(Horas < 10){PrindHoras = "0"+Horas;} else {PrindHoras = Horas;}

			// Imprimir
			if(Segundos>=0) {CuentaRegresiva.innerHTML = PrindHoras+" : "+PrindMinutos+" : "+PrindSegundos;}
		},1000);
	}



	// Definir lista de extensiones y el tipo de fichero de audio asociado
	var html5_audiotypes={
		"mp3": "audio/mpeg",
		"mp4": "audio/mp4",
		"ogg": "audio/ogg",
		"wav": "audio/wav"
	}

	//Elegir sonido
	var finish = createsoundbite('https://sfx.freeaudiolibrary.com/es/module/pp_api/streaming?id_product=35424');

	//Inicializar sonidos
	function createsoundbite(sound){
		var html5audio=document.createElement('audio')
		if (html5audio.canPlayType){ //Comprobar soporte para audio HTML5
			for (var i=0; i<arguments.length; i++){
				var sourceel=document.createElement('source')
				sourceel.setAttribute('src', arguments[i])
				if (arguments[i].match(/.(w+)$/i))
				sourceel.setAttribute('type', html5_audiotypes[RegExp.$1])
				html5audio.appendChild(sourceel)
			}
			html5audio.load()
			html5audio.playclip=function(){
				html5audio.pause()
				html5audio.currentTime=0
				html5audio.play()
			}
			return html5audio
		} else {alert("Su navegador no soporta audio HTML5");}
	}
</script>
</body>
</html>
